<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PS1 ISO Executor Pro</title>
    <style>
        :root { --neon-green: #00ff41; --bg-dark: #0a0a0a; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg-dark); color: var(--neon-green); font-family: 'Courier New', monospace; overflow: hidden; }
        
        #boot-sequence {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; z-index: 1000; padding: 20px; box-sizing: border-box;
            display: flex; flex-direction: column; justify-content: flex-start;
        }

        .terminal-text { font-size: 14px; line-height: 1.5; margin-bottom: 5px; border-left: 3px solid var(--neon-green); padding-left: 10px; opacity: 0; animation: fadeIn 0.3s forwards; }
        
        #progress-container { width: 100%; height: 20px; border: 1px solid var(--neon-green); margin-top: 20px; display: none; }
        #progress-bar { width: 0%; height: 100%; background: var(--neon-green); transition: width 0.2s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #game-canvas { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none; }
        
        .start-btn {
            background: transparent; color: var(--neon-green); border: 2px solid var(--neon-green);
            padding: 15px 40px; font-size: 18px; cursor: pointer; margin-top: auto; align-self: center;
            display: none; transition: 0.3s;
        }
        .start-btn:hover { background: var(--neon-green); color: black; }
    </style>
</head>
<body>

    <div id="boot-sequence">
        <div id="logs"></div>
        <div id="progress-container"><div id="progress-bar"></div></div>
        <button id="launchBtn" class="start-btn">INITIALIZE CORE</button>
    </div>

    <div id="game-canvas"></div>

    <script>
        const logs = document.getElementById('logs');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');
        const launchBtn = document.getElementById('launchBtn');

        function addLog(text, delay = 500) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const div = document.createElement('div');
                    div.className = 'terminal-text';
                    div.innerText = `> ${text}`;
                    logs.appendChild(div);
                    resolve();
                }, delay);
            });
        }

        async function startEngine() {
            await addLog("SYSTEM BOOT: PS1 HIGH COMMAND v4.0");
            await addLog("SCANNING LOCAL STORAGE...");
            
            // File Paths
            const ISO_PATH = "game.iso";
            const BIOS_PATH = "scph001.bin";

            try {
                // Step 1: Check BIOS
                await addLog(`LOADING BIOS: ${BIOS_PATH}...`);
                const biosRes = await fetch(BIOS_PATH);
                if(!biosRes.ok) throw new Error("BIOS NOT FOUND! Check scph001.bin");
                await addLog("BIOS MOUNTED SUCCESSFULLY.");

                // Step 2: Download ISO into RAM
                await addLog(`DOWNLOADING ISO: ${ISO_PATH}...`);
                progressContainer.style.display = "block";
                
                const response = await fetch(ISO_PATH);
                const reader = response.body.getReader();
                const contentLength = +response.headers.get('Content-Length');
                
                let receivedLength = 0;
                let chunks = []; 
                while(true) {
                    const {done, value} = await reader.read();
                    if (done) break;
                    chunks.push(value);
                    receivedLength += value.length;
                    let percent = Math.floor((receivedLength / contentLength) * 100);
                    progressBar.style.width = percent + "%";
                }

                await addLog("DOWNLOAD COMPLETE. DATA INTEGRITY VERIFIED.");
                await addLog("PREPARING EMULATION CORE (PSX)...");
                
                launchBtn.style.display = "block";
                launchBtn.onclick = () => {
                    document.getElementById('boot-sequence').style.display = 'none';
                    document.getElementById('game-canvas').style.display = 'block';
                    loadEmulator(ISO_PATH, BIOS_PATH);
                };

            } catch (err) {
                await addLog("FATAL ERROR: " + err.message);
                logs.style.color = "red";
            }
        }

        function loadEmulator(game, bios) {
            window.EmuJS_path = "https://cdn.jsdelivr.net/gh/EmulatorJS/EmulatorJS@latest/data/";
            window.EmuJS_gameUrl = game;
            window.EmuJS_biosUrl = bios;
            window.EmuJS_core = "psx";
            window.EmuJS_startOnLoaded = true;

            const loader = document.createElement('script');
            loader.src = "https://cdn.jsdelivr.net/gh/EmulatorJS/EmulatorJS@latest/data/loader.js";
            document.body.appendChild(loader);
        }

        window.onload = startEngine;
    </script>
</body>
</html>
